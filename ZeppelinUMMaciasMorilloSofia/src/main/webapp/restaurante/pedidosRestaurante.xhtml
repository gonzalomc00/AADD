<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/template/template_privada.xhtml"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
	<ui:param name="menuseleccionado" value="estilo2" />
	<ui:define name="title">
		Pedidos de un restaurante
    </ui:define>
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{pedidoRestauranteList.restauranteId}" />
			<f:viewAction action="#{pedidoRestauranteList.loadPedidos()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<div class="card">
			<h:form id="tablaPedidos">
				<p:dataTable id="listaPedidos" var="pedido"
					value="#{pedidoRestauranteList.pedidos}"
					rowKey="#{pedido.nombreCliente}">

					<f:facet name="header">
				Pulsa sobre la flecha para ver los detalles del envío
            </f:facet>
					<p:column style="width:2rem">
						<p:rowToggler />
					</p:column>

					<p:column headerText="Nombre del cliente">
						<h:outputText value="#{pedido.nombreCliente}" />
					</p:column>

					<p:column headerText="Importe">
						<h:outputText value="#{pedido.importe}">
							<f:convertNumber type="currency" currencySymbol="€" />
						</h:outputText>
					</p:column>

					<p:column headerText="Fecha de creación">
						<h:outputText value="#{pedido.fechaHora}" />
					</p:column>
					<p:column headerText="Fecha de llegada esperada">
						<h:outputText value="#{pedido.fechaEsperado}" />
					</p:column>
					<p:column headerText="Estado">
						<h:outputText value="#{pedido.ultimoEstado.nombreEstado}" />
					</p:column>
					<p:column headerText="Cambiar estado">
						<p:commandButton type="botonAceptar" value="Aceptar"
							action="#{pedidoRestauranteList.cambiarEstadoPedido(pedido.id,'ACEPTADO')}"
							rendered="#{pedido.ultimoEstado.nombreEstado eq 'INICIO'}"
							styleClass="ui-button-success" update="tablaPedidos"
							style="margin-bottom:5px" />

						<p:commandButton type="botonRechazar" value="Cancelar"
							action="#{pedidoRestauranteList.cambiarEstadoPedido(pedido.id,'CANCELADO')}"
							rendered="#{pedido.ultimoEstado.nombreEstado eq 'INICIO'}"
							styleClass="ui-button-danger" update="tablaPedidos" />

						<p:commandButton type="botonRechazar" value="Preparado"
							action="#{pedidoRestauranteList.cambiarEstadoPedido(pedido.id,'PREPARADO')}"
							rendered="#{pedido.ultimoEstado.nombreEstado eq 'ACEPTADO'}"
							styleClass="ui-button-info" update="tablaPedidos" />

						<p:commandButton type="botonRechazar" value="Recogido"
							action="#{pedidoRestauranteList.cambiarEstadoPedido(pedido.id,'RECOGIDO')}"
							rendered="#{pedido.ultimoEstado.nombreEstado eq 'PREPARADO'}"
							styleClass="ui-button-info" update="tablaPedidos" />


					</p:column>
					<p:rowExpansion>
						<div class="pedidoDetalles">
							<p:dataTable var="itemPedido" value="#{pedido.items}">
								<p:column headerText="Nombre del plato">
									<h:outputText value="#{itemPedido.nombrePlato}" />
								</p:column>
								<p:column headerText="Precio del plato">
									<h:outputText value="#{itemPedido.precioPlato}">
										<f:convertNumber type="currency" currencySymbol="€" />
									</h:outputText>
								</p:column>
								<p:column headerText="Unidades">
									<h:outputText value="#{itemPedido.cantidad}">

									</h:outputText>
								</p:column>
								<p:column headerText="Coste total">
									<h:outputText value="#{itemPedido.costeTotal}">
										<f:convertNumber type="currency" currencySymbol="€" />
									</h:outputText>
								</p:column>

							</p:dataTable>
						</div>

						<h1>Detalles del envío:</h1>
						<h:panelGrid columns="2">
							<h:outputLabel value="Dirección de envío: " />
							<h:outputLabel value="#{pedido.datosDireccion}" />
							<h:outputLabel value="Nombre repartidor:" />
							<h:outputLabel value="#{pedido.nombreRepartidor}" />
							<h:outputLabel value="Comentario: " />
							<h:outputLabel value="#{pedido.comentario}" />

						</h:panelGrid>

					</p:rowExpansion>
				</p:dataTable>


			</h:form>
		</div>
	</ui:define>
</ui:composition>